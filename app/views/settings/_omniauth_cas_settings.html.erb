<%
  # Check which fields are controlled by YAML config file
  cas_server_from_config_file = RedmineOmniauthCas.from_yaml_config_file?('cas_server')
  cas_validate_url_from_config_file = RedmineOmniauthCas.from_yaml_config_file?('cas_service_validate_url')
  yaml_config_file_exists = RedmineOmniauthCas.yaml_config_exists?
%>

<% flash.now[:error] = "#{l("label_cas_server")} #{l("activerecord.errors.messages.blank")}" if @settings['cas_server'].blank? && !cas_server_from_config_file %>

<p>
  <label><%= l(:label_cas_enabled) %></label>
  <%= check_box_tag 'settings[enabled]', true, @settings['enabled'] %>
</p>

<p>
  <label><%= l(:label_cas_server) %><span class="required"> *</span></label>
  <% if cas_server_from_config_file %>
    <%= text_field_tag 'settings[cas_server]', RedmineOmniauthCas.cas_server,
                       :size => 80, :disabled => true %>
  <% else %>
    <%= text_field_tag 'settings[cas_server]', @settings['cas_server'], :size => 80 %>
  <% end %>
</p>

<p>
  <label><%= l(:label_cas_service_validate_url) %></label>
  <% if cas_validate_url_from_config_file %>
    <%= text_field_tag 'settings[cas_service_validate_url]', RedmineOmniauthCas.cas_service_validate_url,
                       :size => 80, :disabled => true %>
    <br/>
    <% if yaml_config_file_exists && (cas_server_from_config_file || cas_validate_url_from_config_file) %>
      <em class="info">
        <%= l(:notice_cas_yaml_config_active) %>
        <code><%= RedmineOmniauthCas.yaml_config_path %></code>
      </em>
    <% end %>
  <% else %>
    <%= text_field_tag 'settings[cas_service_validate_url]', @settings['cas_service_validate_url'], :size => 80 %>
    <br/>
    <em><%= l(:label_example) %>: https://cas.example.net/serviceValidate</em>
  <% end %>
</p>

<p>
  <label><%= l(:label_login_page_text) %></label>
  <%= text_field_tag 'settings[label_login_with_cas]', @settings['label_login_with_cas'], :size => 50 %>
</p>

<p>
  <label><%= l(:label_replace_redmine_login) %></label>
  <%= check_box_tag 'settings[replace_redmine_login]', true, @settings['replace_redmine_login'] %>
</p>
